<main class="flex flex-col gap-2 overflow-x-auto h-screen">
  <div
    class="flex flex-row gap-2 w-full bg-gray-600 p-2 sticky top-0 left-0 z-50"
  >
    <div
      (click)="open(wipeConfirmation)"
      class="grid place-content-center select-none p-4 rounded-full bg-red-400 hover:bg-red-500 transition-all h-10 w-fit cursor-pointer"
    >
      <div class="flex flex-row gap-2 items-center">
        <i class="ph ph-trash"></i>
        <span class="hidden md:block">Wipe Data</span>
      </div>
    </div>
    <div
      (click)="exportAndDownload()"
      class="grid place-content-center select-none p-4 rounded-full bg-green-400 hover:bg-green-500 transition-all h-10 w-fit cursor-pointer"
    >
      <div class="flex flex-row gap-2 items-center">
        <i class="ph ph-file-arrow-down"></i>
        <span class="hidden md:block">Download</span>
      </div>
    </div>
    <div
      (click)="takeScreenshot()"
      class="grid place-content-center select-none p-4 rounded-full bg-blue-200 hover:bg-blue-300 transition-all h-10 w-fit cursor-pointer"
    >
      <div class="flex flex-row gap-2 items-center">
        <i class="ph ph-projector-screen"></i>
        <span class="hidden md:block">Screenshot</span>
      </div>
    </div>
    <div
      (click)="updateExportHash(); open(exportModal)"
      class="grid place-content-center select-none p-4 rounded-full bg-blue-200 hover:bg-blue-300 transition-all h-10 w-fit cursor-pointer"
    >
      <div class="flex flex-row gap-2 items-center">
        <i class="ph ph-share-network"></i>
        <span class="hidden md:block">Export</span>
      </div>
    </div>
    <div
      (click)="open(importModal)"
      class="grid place-content-center select-none p-4 rounded-full bg-blue-200 hover:bg-blue-300 transition-all h-10 w-fit cursor-pointer"
    >
      <div class="flex flex-row gap-2 items-center">
        <i class="ph ph-download-simple"></i>
        <span class="hidden md:block">Import</span>
      </div>
    </div>
    <div
      (click)="addColumn()"
      class="grid place-content-center select-none p-4 rounded-full bg-blue-200 hover:bg-blue-300 transition-all h-10 w-fit cursor-pointer"
    >
      <div class="flex flex-row gap-2 items-center">
        <i class="ph ph-plus"></i>
        <span class="hidden md:block">Add Column</span>
      </div>
    </div>
  </div>
  <div class="p-3">
    <div
      cdkDropList
      cdkDropListOrientation="horizontal"
      (cdkDropListDropped)="drop($event)"
      #dropList="cdkDropList"
    >
      <form id="schedule" [formGroup]="form" class="flex flex-row gap-4 w-fit">
        @for (column of form.controls.columns.controls; track
        column.controls.id; let i = $index) {
        <div
          #columnContainer
          class="flex flex-col divide-y w-[400px] min-w-[400px] select-none"
          cdkDrag
          [cdkDragStartDelay]="{
            touch: 200,
            mouse: 0
          }"
          [cdkDragLockAxis]="'x'"
          formArrayName="columns"
          (cdkDragStarted)="columnDragStarted(columnContainer)"
          (cdkDragEnded)="columnDragEnded(columnContainer)"
        >
          <header
            class="text-center bg-blue-500 rounded-t-md py-2 font-bold text-xl cursor-grabbing text-white flex flex-row gap-2 items-center justify-between px-4"
            cdkDragHandle
            [formGroupName]="i"
          >
            <button
              class="grid place-items-center w-[32px] h-[32px] rounded-full cursor-pointer hover:bg-blue-400 transition-all"
              (click)="open(deleteColumnConfirmation)"
            >
              <i class="ph ph-trash"></i>
            </button>
            <input
              type="text"
              formControlName="title"
              class="p-2 bg-blue-900 text-center border rounded-md w-[300px]"
            />
          </header>
          <sch-schedule
            [columnId]="column.controls.id.value"
            (mousedown)="$event.stopPropagation()"
          />
        </div>
        <ng-template #deleteColumnConfirmation let-modal>
          <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Delete Column</h4>
            <button
              type="button"
              class="btn-close"
              aria-label="Close"
              (click)="modal.dismiss()"
            ></button>
          </div>
          <div class="modal-body">
            Do you really want to remove '<b class="font-bold">{{
              column.controls.title.value
            }}</b
            >' column?
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="removeColumn(column.controls.id.value); modal.close()"
            >
              Yes
            </button>
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="modal.dismiss()"
            >
              No
            </button>
          </div>
        </ng-template>
        }
      </form>
    </div>
  </div>
</main>

<ng-template #wipeConfirmation let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Wipe Data</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss()"
    ></button>
  </div>
  <div class="modal-body">Do you really want to wipe all the data?</div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-outline-secondary"
      (click)="wipeData(); modal.close()"
    >
      Yes
    </button>
    <button
      type="button"
      class="btn btn-outline-secondary"
      (click)="modal.dismiss()"
    >
      No
    </button>
  </div>
</ng-template>

<ng-template #exportModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Export</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss()"
    ></button>
  </div>
  <div class="modal-body">
    <button
      class="flex flex-row items-center gap-2 mx-auto text-white bg-blue-600 rounded-md px-4 py-2"
      (click)="copyToClipboard(); modal.dismiss()"
    >
      <i class="ph ph-copy-simple text-xl"></i>
      <span>Copy hash to clipboard</span>
    </button>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-outline-secondary"
      (click)="modal.dismiss()"
    >
      Close
    </button>
  </div>
</ng-template>

<ng-template #importModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Import</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss()"
    ></button>
  </div>
  <div class="modal-body flex flex-col gap-2">
    <span>Import schedule</span>
    <input
      type="text"
      class="border rounded-md px-2 py-1"
      #importField
      placeholder="Enter import hash"
    />
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-outline-secondary"
      (click)="import(importField.value); modal.close()"
    >
      Import
    </button>
    <button
      type="button"
      class="btn btn-outline-secondary"
      (click)="modal.dismiss()"
    >
      Cancel
    </button>
  </div>
</ng-template>
